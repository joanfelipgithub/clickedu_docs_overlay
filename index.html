<!DOCTYPE html>
<html lang="ca">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Clickedu â€“ bookmarklet per la finestra de Documents</title>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  margin: 2rem;
Â  Â  Â  background: #f5f5f5;
Â  Â  Â  color: #333;
Â  Â  Â  line-height: 1.6;
Â  Â  }
Â  Â  .container {
Â  Â  Â  max-width: 720px;
Â  Â  Â  margin: auto;
Â  Â  Â  background: white;
Â  Â  Â  padding: 2rem;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  .bookmarklet {
Â  Â  Â  display: inline-block;
Â  Â  Â  background: #ff6b35;
Â  Â  Â  color: #fff;
Â  Â  Â  padding: 12px 24px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-top: 1rem;
Â  Â  Â  cursor: move;
Â  Â  Â  font-size: 16px;
Â  Â  Â  box-shadow: 0 2px 8px rgba(255,107,53,0.3);
Â  Â  Â  transition: all 0.2s;
Â  Â  }
Â  Â  .bookmarklet:hover {
Â  Â  Â  background: #e55a28;
Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  box-shadow: 0 4px 12px rgba(255,107,53,0.4);
Â  Â  }
Â  Â  #copyBox {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 0.8rem;
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  border: 2px solid #ddd;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  font-family: monospace;
Â  Â  Â  background: #f9f9f9;
Â  Â  }
Â  Â  #copyBtn {
Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  padding: 8px 16px;
Â  Â  Â  background: #28a745;
Â  Â  Â  color: #fff;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-weight: bold;
Â  Â  Â  transition: background 0.2s;
Â  Â  }
Â  Â  #copyBtn:hover {
Â  Â  Â  background: #218838;
Â  Â  }
Â  Â  .instruction {
Â  Â  Â  background: #e3f2fd;
Â  Â  Â  padding: 1rem;
Â  Â  Â  border-left: 4px solid #2196f3;
Â  Â  Â  margin: 1rem 0;
Â  Â  Â  border-radius: 4px;
Â  Â  }
Â  Â  hr {
Â  Â  Â  margin: 2rem 0;
Â  Â  Â  border: none;
Â  Â  Â  border-top: 2px solid #eee;
Â  Â  }
Â  </style>
</head>
<body>
<div class="container">
Â  <h1>ğŸ“‚ Clickedu â€“ Finestra de documents</h1>

Â  <div class="instruction">
Â  Â  <p><strong>1ï¸âƒ£ Arrossega el botÃ³ taronja de sota a la barra de marcadors del teu navegador</strong></p>
Â  Â  <p>AixÃ² desa un bookmarklet que s'executarÃ  a Clickedu per mostrar els teus documents en una finestra molt prÃ ctica.</p>
Â  </div>

Â  <div style="text-align: center; padding: 20px; background: #fafafa; border-radius: 8px; margin: 1rem 0;">
Â  Â  <a class="bookmarklet" id="bookmarkletLink" href="#">
Â  Â  Â  ğŸ“‚ Docs Clickedu
Â  Â  </a>
Â  Â  <p style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
Â  Â  Â  â¬†ï¸ Arrossega aquest botÃ³ a la barra de marcadors
Â  Â  </p>
Â  </div>

Â  <div class="instruction">
Â  Â  <p><strong>2ï¸âƒ£ Alternativa: Copia al porta-retalls</strong></p>
Â  Â  <p>Si arrossegar no funciona (mÃ²bil o restriccions del navegador), fes clic al botÃ³ Copia de sota, desprÃ©s crea un marcador nou manualment i enganxa l'URL.</p>
Â  </div>

Â  <textarea id="copyBox" rows="4" readonly></textarea>
Â  <button id="copyBtn">ğŸ“‹ Copia al porta-retalls</button>

Â  <hr>
Â Â 
Â  <p style="font-size: 0.9rem; color: #666;">
Â  Â  <strong>â„¹ï¸ Com funciona:</strong> Aquesta versiÃ³ carrega la llista de documents automÃ ticament des del Full de CÃ lcul de Google utilitzant un servidor intermediari per evitar els errors de seguretat CORS, i usa la primera columna per aplicar colors diferents.
Â  </p>
</div>

<script>
// IMPORTANT: Use the /export URL format, and ensure your sheet is published to the web!
const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1iAF3p81G8DdByShDyfz4ShoweV80QWuoQ7wWSzZUORQ/export?format=csv&gid=0';

// This CORS proxy is added to allow the fetch request to succeed from any origin.
const PROXY_URL = 'https://cors-anywhere.herokuapp.com/'; 
const FINAL_FETCH_URL = PROXY_URL + GOOGLE_SHEET_URL;

// The bookmarklet code that fetches from Google Sheets via the proxy
const bookmarkletCode = `javascript:(async function(){
Â  Â  if(!location.href.includes('insscf.clickedu.eu/sumari/index.php?p=links')){
Â  Â  Â  Â  alert('âš ï¸ Aquest bookmarklet nomÃ©s funciona a la pÃ gina "links" de Clickedu.');
Â  Â  Â  Â  return;
Â  Â  }
Â  Â Â 
    // Define the color map inside the bookmarklet code
    const COLOR_MAP = {
        '1': { main: '#4CAF50', hover: '#388E3C' },
        '2': { main: '#FF9800', hover: '#F57C00' },
        '3': { main: '#00BCD4', hover: '#0097A7' },
        '4': { main: '#E91E63', hover: '#C2185B' },
        '5': { main: '#673AB7', hover: '#512DA8' },
        'default': { main: '#007bff', hover: '#0056b3' }
    };

Â  Â  // UI Cleanup (Hiding the existing form)
Â  Â  let formNode=null,containerNode=null;
Â  Â  const formXPath='//form[@action="https://shorturl.at/anS1H"]';
Â  Â  formNode=document.evaluate(formXPath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;
Â  Â  if(formNode){
Â  Â  Â  Â  containerNode=formNode.closest('.bloc-info-sumari');
Â  Â  Â  Â  if(containerNode){
Â  Â  Â  Â  Â  Â  containerNode.style.display='none';
Â  Â  Â  Â  }else{
Â  Â  Â  Â  Â  Â  formNode.style.display='none';
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // Floating Button Setup
Â  Â  const btn=document.createElement('button');
Â  Â  btn.textContent='ğŸ“‚ Mostrar documents';
Â  Â  Object.assign(btn.style,{position:'fixed',top:'10px',right:'10px',zIndex:9999,padding:'10px 15px',background:'#007bff',color:'#fff',border:'none',borderRadius:'8px',cursor:'pointer',boxShadow:'0 2px 4px rgba(0,0,0,.2)',transition:'background .2s,opacity .3s',fontWeight:'bold',opacity:'1'});
Â  Â  btn.onmouseover=function(){btn.style.background='#0056b3'};
Â  Â  btn.onmouseout=function(){btn.style.background='#007bff'};
Â  Â  document.body.appendChild(btn);

Â  Â  let overlayVisible=!1;
Â  Â  btn.onclick=async function(){
Â  Â  Â  Â  // Hide existing element
Â  Â  Â  Â  if(containerNode){containerNode.style.display='none'}else if(formNode){formNode.style.display='none'};
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Toggle overlay
Â  Â  Â  Â  if(overlayVisible){closeOverlay();btn.style.opacity='1';return;}
Â  Â  Â  Â  overlayVisible=!0;
Â  Â  Â  Â  btn.style.opacity='0.2';
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Overlay and Loading Message
Â  Â  Â  Â  const overlay=document.createElement('div');
Â  Â  Â  Â  Object.assign(overlay.style,{position:'fixed',top:0,left:0,width:'100%',height:'100%',background:'rgba(0,0,0,0.8)',zIndex:9998,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:'20px',overflowY:'auto'});
Â  Â  Â  Â  overlay.addEventListener('click',e=>{e.target===overlay&&closeOverlay()});
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.addEventListener('keydown',esc);
Â  Â  Â  Â  function esc(e){e.key==='Escape'&&closeOverlay()}
Â  Â  Â  Â  function closeOverlay(){overlay.remove();document.removeEventListener('keydown',esc);overlayVisible=!1;btn.style.opacity='1'}
Â  Â  Â  Â Â 
Â  Â  Â  Â  const loadingMsg=document.createElement('div');
Â  Â  Â  Â  loadingMsg.textContent='â³ Carregant documents (via proxy)...';
Â  Â  Â  Â  Object.assign(loadingMsg.style,{color:'white',fontSize:'18px',marginBottom:'20px'});
Â  Â  Â  Â  overlay.appendChild(loadingMsg);
Â  Â  Â  Â  document.body.appendChild(overlay);

Â  Â  Â  Â  try{
Â  Â  Â  Â  Â  Â  // Fetching the Google Sheets CSV via the CORS proxy
Â  Â  Â  Â  Â  Â  const csvUrl='${FINAL_FETCH_URL}';
Â  Â  Â  Â  Â  Â  const response=await fetch(csvUrl);
Â  Â  Â  Â  Â  Â  if(!response.ok) throw new Error('CÃ rrega fallida. Codi: '+response.status);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const csvText=await response.text();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // MODIFIED CSV PARSING LOGIC: Expecting 3 columns: Group, Label, URL
Â  Â  Â  Â  Â  Â  const lines=csvText.split('\\n').slice(1);
Â  Â  Â  Â  Â  Â  const docs=lines.filter(line=>line.trim()).map(line=>{
Â  Â  Â  Â  Â  Â  Â  Â  // Splits on comma but respects quoted fields
Â  Â  Â  Â  Â  Â  Â  Â  const parts = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(p => p.replace(/^"|"$/g, '').trim());
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(parts.length >= 3){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return{g:parts[0], l:parts[1], u:parts[2]} // g=Group, l=Label, u=URL
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return null; // Invalid row
Â  Â  Â  Â  Â  Â  }).filter(doc=>doc && doc.g && doc.l && doc.u); // Filter out empty/invalid rows

Â  Â  Â  Â  Â  Â  loadingMsg.remove();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(docs.length===0){
Â  Â  Â  Â  Â  Â  Â  Â  loadingMsg.textContent='âš ï¸ No s\\'han trobat documents vÃ lids al full de cÃ lcul.';
Â  Â  Â  Â  Â  Â  Â  Â  loadingMsg.style.color='#ffc107';
Â  Â  Â  Â  Â  Â  Â  Â  overlay.appendChild(loadingMsg);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Document Grid Rendering
Â  Â  Â  Â  Â  Â  const grid=document.createElement('div');
Â  Â  Â  Â  Â  Â  Object.assign(grid.style,{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(280px,1fr))',gap:'15px',maxWidth:'1200px',width:'100%'});
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  docs.forEach(o=>{
Â  Â  Â  Â  Â  Â  Â  Â  const b=document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  b.textContent=o.l;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // NEW: COLOR LOGIC
Â  Â  Â  Â  Â  Â  Â  Â  const colors = COLOR_MAP[o.g] || COLOR_MAP.default;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Object.assign(b.style,{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding:'15px',fontSize:'16px',cursor:'pointer',borderRadius:'12px',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  border:'none',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  background:colors.main, // Set main color
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color:'#fff',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  boxShadow:'0 4px 6px rgba(0,0,0,0.2)',transition:'background .2s'
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  b.onmouseover=function(){b.style.background=colors.hover}; // Set hover color
Â  Â  Â  Â  Â  Â  Â  Â  b.onmouseout=function(){b.style.background=colors.main};Â  // Revert on mouseout
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  b.onclick=function(){window.open(o.u,'_blank')}; // Opens link in new tab
Â  Â  Â  Â  Â  Â  Â  Â  grid.appendChild(b);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  overlay.appendChild(grid);

Â  Â  Â  Â  }catch(err){
Â  Â  Â  Â  Â  Â  loadingMsg.textContent='âŒ Error crÃ­tic: No s\\'ha pogut carregar la llista. Detall: '+err.message;
Â  Â  Â  Â  Â  Â  loadingMsg.style.color:'#ff6b6b';
Â  Â  Â  Â  }
Â  Â  };
})();`;

// Set the href using JavaScript
document.getElementById('bookmarkletLink').href = bookmarkletCode;

// Set the textarea content
document.getElementById('copyBox').value = bookmarkletCode;

// Copy to clipboard functionality
document.getElementById('copyBtn').addEventListener('click', function() {
Â  Â  const ta = document.getElementById('copyBox');
Â  Â  ta.select();
Â  Â  ta.setSelectionRange(0, 99999);
Â  Â Â 
Â  Â  navigator.clipboard.writeText(ta.value).then(() => {
Â  Â  Â  Â  const btn = document.getElementById('copyBtn');
Â  Â  Â  Â  btn.textContent = 'âœ… Copiat!';
Â  Â  Â  Â  btn.style.background = '#218838';
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  btn.textContent = 'ğŸ“‹ Copia al porta-retalls';
Â  Â  Â  Â  Â  Â  btn.style.background = '#28a745';
Â  Â  Â  Â  }, 2000);
Â  Â  }).catch(() => {
Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  alert('Bookmarklet copiat! Ara crea un marcador nou i enganxa\'l.');
Â  Â  });
});
</script>
</body>
</html>
