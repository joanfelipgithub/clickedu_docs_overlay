<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clickedu ‚Äì bookmarklet per la finestra de Documents</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 720px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .bookmarklet {
      display: inline-block;
      background: #ff6b35;
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      margin-top: 1rem;
      cursor: move;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(255,107,53,0.3);
      transition: all 0.2s;
    }
    .bookmarklet:hover {
      background: #e55a28;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255,107,53,0.4);
    }
    #copyBox {
      width: 100%;
      padding: 0.8rem;
      font-size: 0.85rem;
      margin-top: 0.5rem;
      box-sizing: border-box;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      background: #f9f9f9;
    }
    #copyBtn {
      margin-top: 0.5rem;
      padding: 8px 16px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }
    #copyBtn:hover {
      background: #218838;
    }
    .instruction {
      background: #e3f2fd;
      padding: 1rem;
      border-left: 4px solid #2196f3;
      margin: 1rem 0;
      border-radius: 4px;
    }
    hr {
      margin: 2rem 0;
      border: none;
      border-top: 2px solid #eee;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>üìÇ Clickedu ‚Äì Finestra de documents</h1>

  <div class="instruction">
    <p><strong>1Ô∏è‚É£ Arrossega el bot√≥ taronja de sota a la barra de marcadors del teu navegador</strong></p>
    <p>Aix√≤ desa un bookmarklet que s'executar√† a Clickedu per mostrar els teus documents en una finestra molt pr√†ctica.</p>
  </div>

  <div style="text-align: center; padding: 20px; background: #fafafa; border-radius: 8px; margin: 1rem 0;">
    <a class="bookmarklet" id="bookmarkletLink" href="#">
      üìÇ Docs Clickedu
    </a>
    <p style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
      ‚¨ÜÔ∏è Arrossega aquest bot√≥ a la barra de marcadors
    </p>
  </div>

  <div class="instruction">
    <p><strong>2Ô∏è‚É£ Alternativa: Copia al porta-retalls</strong></p>
    <p>Si arrossegar no funciona (m√≤bil o restriccions del navegador), fes clic al bot√≥ Copia de sota, despr√©s crea un marcador nou manualment i enganxa l'URL.</p>
  </div>

  <textarea id="copyBox" rows="4" readonly></textarea>
  <button id="copyBtn">üìã Copia al porta-retalls</button>

  <hr>
  
  <p style="font-size: 0.9rem; color: #666;">
    <strong>‚ÑπÔ∏è Com funciona:</strong> Els documents es carreguen autom√†ticament des d'una font centralitzada cada vegada que executis el bookmarklet. Sempre tindr√†s acc√©s a la llista m√©s actualitzada.
  </p>
</div>

<script>
// REPLACE THIS URL WITH YOUR ACTUAL PUBLISHED CSV URL FROM GOOGLE SHEETS
const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/1iAF3p81G8DdByShDyfz4ShoweV80QWuoQ7wWSzZUORQ/export?format=csv&gid=0';

// The bookmarklet code that fetches from Google Sheets
const bookmarkletCode = `javascript:(function(){if(!location.href.includes('insscf.clickedu.eu/sumari/index.php?p=links')){alert('‚ö†Ô∏è Aquest bookmarklet nom√©s funciona a la p√†gina "links" de Clickedu.');return;}let formNode=null,containerNode=null;const formXPath='//form[@action="https://shorturl.at/anS1H"]';formNode=document.evaluate(formXPath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(formNode){containerNode=formNode.closest('.bloc-info-sumari');if(containerNode){containerNode.style.display='none';}else{formNode.style.display='none';}}const btn=document.createElement('button');btn.textContent='üìÇ Mostrar documents';Object.assign(btn.style,{position:'fixed',top:'10px',right:'10px',zIndex:9999,padding:'10px 15px',background:'#007bff',color:'#fff',border:'none',borderRadius:'8px',cursor:'pointer',boxShadow:'0 2px 4px rgba(0,0,0,.2)',transition:'background .2s,opacity .3s',fontWeight:'bold',opacity:'1'});btn.onmouseover=function(){btn.style.background='#0056b3'};btn.onmouseout=function(){btn.style.background='#007bff'};document.body.appendChild(btn);let overlayVisible=!1;btn.onclick=async function(){if(containerNode){containerNode.style.display='none'}else if(formNode){formNode.style.display='none'};if(overlayVisible){closeOverlay();btn.style.opacity='1';return;}overlayVisible=!0;btn.style.opacity='0.2';const overlay=document.createElement('div');Object.assign(overlay.style,{position:'fixed',top:0,left:0,width:'100%',height:'100%',background:'rgba(0,0,0,0.6)',zIndex:9998,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:'20px',overflowY:'auto'});overlay.addEventListener('click',e=>{e.target===overlay&&closeOverlay()});document.addEventListener('keydown',esc);function esc(e){e.key==='Escape'&&closeOverlay()}function closeOverlay(){overlay.remove();document.removeEventListener('keydown',esc);overlayVisible=!1;btn.style.opacity='1'}const loadingMsg=document.createElement('div');loadingMsg.textContent='‚è≥ Carregant documents...';Object.assign(loadingMsg.style,{color:'white',fontSize:'18px',marginBottom:'20px'});overlay.appendChild(loadingMsg);document.body.appendChild(overlay);try{const csvUrl='${SHEET_CSV_URL}';const response=await fetch(csvUrl);const csvText=await response.text();const lines=csvText.split('\\n').slice(1);const docs=lines.filter(line=>line.trim()).map(line=>{const match=line.match(/^"?([^",]+)"?,+"?([^"]+)"?$/);if(match){return{l:match[1].trim(),u:match[2].trim()}}const parts=line.split(',');return{l:parts[0]?.replace(/^"+|"+$/g,'').trim(),u:parts[1]?.replace(/^"+|"+$/g,'').trim()}}).filter(doc=>doc.l&&doc.u);loadingMsg.remove();if(docs.length===0){loadingMsg.textContent='‚ö†Ô∏è No s\\'han trobat documents';loadingMsg.style.color='#ffc107';overlay.appendChild(loadingMsg);return}const grid=document.createElement('div');Object.assign(grid.style,{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(280px,1fr))',gap:'15px',maxWidth:'1200px',width:'100%'});docs.forEach(o=>{const b=document.createElement('button');b.textContent=o.l;Object.assign(b.style,{padding:'15px',fontSize:'16px',cursor:'pointer',borderRadius:'12px',border:'none',background:'#007bff',color:'#fff',boxShadow:'0 4px 6px rgba(0,0,0,0.2)',transition:'background .2s'});b.onmouseover=function(){b.style.background='#0056b3'};b.onmouseout=function(){b.style.background='#007bff'};b.onclick=function(){window.open(o.u,'_blank')};grid.appendChild(b)});overlay.appendChild(grid)}catch(err){loadingMsg.textContent='‚ùå Error carregant documents: '+err.message;loadingMsg.style.color='#ff6b6b'}};})();`;

// Set the href using JavaScript
document.getElementById('bookmarkletLink').href = bookmarkletCode;

// Set the textarea content
document.getElementById('copyBox').value = bookmarkletCode;

// Copy to clipboard functionality
document.getElementById('copyBtn').addEventListener('click', function() {
  const ta = document.getElementById('copyBox');
  ta.select();
  ta.setSelectionRange(0, 99999);
  
  navigator.clipboard.writeText(ta.value).then(() => {
    const btn = document.getElementById('copyBtn');
    btn.textContent = '‚úÖ Copiat!';
    btn.style.background = '#218838';
    setTimeout(() => {
      btn.textContent = 'üìã Copia al porta-retalls';
      btn.style.background = '#28a745';
    }, 2000);
  }).catch(() => {
    document.execCommand('copy');
    alert('Bookmarklet copiat! Ara crea un marcador nou i enganxa\'l.');
  });
});
</script>
</body>
</html>
